#!/usr/bin/env python2
"""Toggle between 'TODO:' and 'DONE:' 

>echo "Done: This thing." | ./toggle_task 
TODO: This thing.

Within vim, use this command:
:.!toggle_task
Or add this to your .vimrc:
:map <Leader>t :.!toggle_task<Cr>

"""
# Copyright 2011 Edward Delaporte <edthedev@gmail.com>
# Licensed under the University of Illinois / NCSA Open Source License 
# http://www.opensource.org/licenses/UoI-NCSA 
# Created: 2011-08-26
import sys
import optparse
from itertools import cycle
import re

TODO = 'TODO:'
TASK_STATES = [TODO, 'DONE:', 'WONT:','WAITING:'] 


def toggleTodo(line):

# Alternate to the next task state in the cycle.
    statecycle = cycle(TASK_STATES)
    next = statecycle.next()
    
    for state in TASK_STATES:
        current, next = next, statecycle.next()
#         print current
        replacer = re.compile(current, re.IGNORECASE)

        if current.lower() in line.lower():
            # Return the line with current replaced with next.
            return replacer.sub(next, line)

    # If we didn't do a replace, add a TODO at the beginning.
    prefix = ''
    if line.startswith('#'):
        line = line.lstrip('#')
        prefix += '#'

    todoer = re.compile('^', re.IGNORECASE)
    return prefix + todoer.sub(TODO + ' ', line, count = 1)

parser = optparse.OptionParser()
(options, args) = parser.parse_args()

if __name__ == '__main__':
    input_lines = sys.stdin.readlines()
    for line in input_lines:
        updated = toggleTodo(line)
        print updated.rstrip('\n')
